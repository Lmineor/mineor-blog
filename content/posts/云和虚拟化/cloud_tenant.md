---
title: "SaaS多租户系统数据隔离实现方案"
date: 2023-06-08
draft: false
tags : [                    # 文章所属标签
    "云与虚拟化"
]
---

> 参考: https://juejin.cn/post/7234763992333189175 

# 背景

简单来说，一个租户就是一个公司的客户，多个租户共用同一个SaaS系统，一旦SaaS系统不可用，那么所有的租户都不可用，

多租户问题,其实是一种架构设计方式，就是在一台或者一组服务器上运行的SaaS系统，可以为多个租户（客户）提供服务，目的是为了让多个租户在互联网环境下使用同一套程序，且保证租户间的数据隔离。从这种架构设计的模式上，不难看出来，多租户架构的重点就是同一套程序下多个租户数据的隔离。由于租户数据是集中存储的，所以要实现数据的安全性，就是看能否实现对租户数据的隔离，防止租户数据不经意或被他人恶意地获取和篡改。

# 多租户数据隔离架构设计

目前SaaS多租户系统的数据隔离有三种架构设计，即：

- 为每个租户提供独立的数据库
- 为每个租户提供独立的表空间
- 按字段区分租户

每种方案都有其各自的适用情况。

## 一个租户一个数据库

一个租户独立使用一个数据库，那就意味着SaaS系统要连接多个数据库，这种实现方案其实和分库分表架构设计是一样的，好处就是数据隔离级别高、安全性好，毕竟一个租户单用一个数据库，但是物理硬件成本、维护成本也变高了。

## 独立的表空间

所有租户共用一个数据库系统，但是每个租户在数据库系统中拥有一个独立的表空间。

## 按租户id字段隔离租户

这种方案是多租户方案中最简单的数据隔离方法，即在每张表中都添加一个用于区分租户的字段（如tenant_id或org_id啥的）来标识每条数据属于哪个租户，当进行查询的时候每条语句都要添加该字段作为过滤条件，其特点是所有租户的数据全都存放在同一个表中，数据的隔离性是最低的，完全是通过字段来区分的，很容易把数据搞串或者误操作。


三种数据隔离架构设计的对比如下：


|隔离方案|成本|支持租户数量|优点|缺点|
|:-|:-|:-|:-|:-|
|独立数据库系统|高|少|数据隔离级别高，安全性，可以针对单个租户开发个性化需求|数据库独立安装，物理成本和维护成本都比较高|
|独立的表空间|中|较多|提供了一定程度的逻辑数据隔离，一个数据库系统可支持多个租户|数据库管理比较困难，表繁多，同时数据修复稍复杂|
|按租户id字段区分|低|多|维护和购置成本最低，每个数据库能够支持的租户数量最多|隔离级别最低，安全性也最低|


